<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.bcs.web.device.mapper.DeviceMapper">
    <select id="selectList" resultType="cn.bcs.web.device.domain.vo.DeviceInfo">
        select d.*, t.tenant_name, concat_ws('-',dt.name) from
            b_device d
            left join sys_tenant t on t.tenant_id = d.tenant_id
            left join b_device_select dd on dd.device_id = d.id
            left join b_select_data dt on dt.type = "sadas" and dt.id = dd.select_id
        where 1=1
        <if test="query.tenantId != null and query.tenantId != ''">
            and d.tenant_id = #{query.tenantId}
        </if>
        <if test="query.deviceName != null and query.deviceName != ''">
            and device_name like concat('%',#{query.deviceName},'%')
        </if>
        <if test="query.address != null and query.address != ''">
            and address like concat('%',#{query.address},'%')
        </if>
        <if test="query.deviceType != null and query.deviceType != ''">
            and device_type = #{query.deviceType}
        </if>
        <if test="query.deviceStatus != null and query.deviceStatus != ''">
            and device_status = #{query.deviceStatus}
        </if>
        <if test="query.deviceCode != null and query.deviceCode != ''">
            and device_code like concat('%',#{query.deviceCode},'%')
        </if>
        <if test="query.deviceNo != null and query.deviceNo != ''">
            and device_no like concat('%',#{query.deviceNo},'%')
        </if>
        <if test="query.fileAreaId != null and query.fileAreaId != ''">
            and file_area_id = #{query.fileAreaId}
        </if>
        <if test="query.onlineStatus != null and query.onlineStatus != ''">
            and online_status = #{query.onlineStatus}
        </if>
        <if test="query.activationBeginTime != null">
          AND (date_format(activation_time, '%Y-%m-%d') BETWEEN date_format(#{query.activationBeginTime}, '%Y-%m-%d') AND date_format(#{query.activationEndTime}, '%Y-%m-%d'))
        </if>
         <if test="query.expireBeginTime != null">
             AND (date_format(expire_time, '%Y-%m-%d') BETWEEN date_format(#{query.expireBeginTime}, '%Y-%m-%d') AND date_format(#{query.expireEndTime}, '%Y-%m-%d'))
         </if>


    </select>
</mapper>